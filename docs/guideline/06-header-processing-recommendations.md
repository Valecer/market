# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –ø–∞—Ä—Å–µ—Ä–∞—Ö

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –ø–∞—Ä—Å–µ—Ä–∞—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤. –î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö —Ç–∞–±–ª–∏—Ü, –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏.

## –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

### 1. –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–≤ –≤—ã—è–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### 1.1. –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö (1, 2, 3, 7 –∏ —Ç.–¥.)
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - –°—Ç—Ä–æ–∫–∞ 1: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ|–°—Å—ã–ª–∫–∞", "–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏", "–§–æ—Ç–æ"
  - –°—Ç—Ä–æ–∫–∞ 3: "–ú–æ–¥–µ–ª—å", "–ó–∞–∫—É–ø–∫–∞ –ë–µ–ª. —Ä—É–±.", "–ú–†–¶ –ë–µ–ª. —Ä—É–±."
  - –°—Ç—Ä–æ–∫–∞ 7: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞", "–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ —Å –ù–î–°", "–†–†–¶"

#### 1.2. –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ (Merged Cells)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –º–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - "–≠–ª–µ–∫—Ç—Ä–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç Shtenli –≠–ª–µ–∫—Ç—Ä–æ-—Å–∫—É—Ç–µ—Ä—ã, —Ç—Ä–∏—Ü–∏–∫–ª—ã. –°–≤–æ–±–æ–¥–∞ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è!" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ C3-F3)
  - "–ú–û–¢–û–ë–õ–û–ö–ò –ò –ú–ò–ù–ò–¢–†–ê–ö–¢–û–†–´" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ A1-E1)

#### 1.3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - –°—Ç—Ä–æ–∫–∞ 2: "–û–ü–¢" / "–ú–†–¶" (–ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Ü–µ–Ω)
  - –°—Ç—Ä–æ–∫–∞ 3: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" / "–§–æ—Ç–æ" / "–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ —Å –ù–î–°" / "–†–†–¶" / "–û—Å—Ç–∞—Ç–æ–∫"

#### 1.4. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü–µ—Ä–µ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –ª–æ–≥–æ—Ç–∏–ø–∞–º–∏, –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - –°—Ç—Ä–æ–∫–∏ 1-2: –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã, –∞–¥—Ä–µ—Å–∞, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
  - –°—Ç—Ä–æ–∫–∏ 1-6: –õ–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏, –æ–ø–∏—Å–∞–Ω–∏–µ, —É—Å–ª–æ–≤–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞

#### 1.5. –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π –¥–ª—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –ø–æ–ª–µ–π
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û–¥–Ω–æ –∏ —Ç–æ –∂–µ –ø–æ–ª–µ –º–æ–∂–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É
- **–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è —Ü–µ–Ω—ã**:
  - "–¶–µ–Ω–∞ —Å –ù–î–°* (BYN)"
  - "–ó–∞–∫—É–ø–∫–∞ –ë–µ–ª. —Ä—É–±."
  - "–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ —Å –ù–î–°"
  - "–ü—Ä–µ–¥–∑–∞–∫–∞–∑ (–ü–ó)*, —Ä—É–±"
  - "–°—Ç–æ–∫*, —Ä—É–±"
  - "–†–¶, —Ä—É–±"
- **–ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –Ω–∞–ª–∏—á–∏—è**:
  - "–ù–∞–ª–∏—á–∏–µ"
  - "–û—Å—Ç–∞—Ç–æ–∫"
  - "–°—Ç–∞—Ç—É—Å"
  - "–≤ –Ω–∞–ª–∏—á–∏–∏" / "–≤ –ø—É—Ç–∏" (–∑–Ω–∞—á–µ–Ω–∏—è, –∞ –Ω–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏)

#### 1.6. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã, —Å–∫–æ–±–∫–∏, –∑–≤–µ–∑–¥–æ—á–∫–∏
- **–ü—Ä–∏–º–µ—Ä—ã**:
  - "–¶–µ–Ω–∞ —Å –ù–î–°* (BYN)" - –∑–≤–µ–∑–¥–æ—á–∫–∞ –∏ —Å–∫–æ–±–∫–∏
  - "–ü—Ä–µ–¥–∑–∞–∫–∞–∑ (–ü–ó)*, —Ä—É–±" - —Å–∫–æ–±–∫–∏, –∑–≤–µ–∑–¥–æ—á–∫–∞, –∑–∞–ø—è—Ç–∞—è
  - "–ú–†–¶* (BYN)" - –∑–≤–µ–∑–¥–æ—á–∫–∞ –∏ —Å–∫–æ–±–∫–∏

#### 1.7. –†—É—Å—Å–∫–∏–π —è–∑—ã–∫
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: `STANDARD_FIELDS` –≤ `GoogleSheetsParser` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
- **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ**: `ExcelParser` –∏ `CsvParser` —Å–æ–¥–µ—Ä–∂–∞—Ç —á–∞—Å—Ç–∏—á–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

#### 2.1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

```python
def _normalize_header(self, header: str) -> str:
    """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
    
    –£–¥–∞–ª—è–µ—Ç:
    - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (*, —Å–∫–æ–±–∫–∏, –∑–∞–ø—è—Ç—ã–µ)
    - –õ–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    - –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    
    Args:
        header: –ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
        
    Returns:
        –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
    """
    import re
    
    # –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    normalized = header.lower().strip()
    
    # –£–¥–∞–ª–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ —Å–∫–æ–±–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, "(BYN)", "(–ü–ó)")
    normalized = re.sub(r'\([^)]*\)', '', normalized)
    
    # –£–¥–∞–ª–∏—Ç—å –∑–≤–µ–∑–¥–æ—á–∫–∏
    normalized = normalized.replace('*', '')
    
    # –£–¥–∞–ª–∏—Ç—å –∑–∞–ø—è—Ç—ã–µ
    normalized = normalized.replace(',', '')
    
    # –£–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    normalized = re.sub(r'\s+', ' ', normalized).strip()
    
    return normalized
```

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π**:
- "–¶–µ–Ω–∞ —Å –ù–î–°* (BYN)" ‚Üí "—Ü–µ–Ω–∞ —Å –Ω–¥—Å"
- "–ü—Ä–µ–¥–∑–∞–∫–∞–∑ (–ü–ó)*, —Ä—É–±" ‚Üí "–ø—Ä–µ–¥–∑–∞–∫–∞–∑ —Ä—É–±"
- "–ú–†–¶* (BYN)" ‚Üí "–º—Ä—Ü"

#### 2.2. –†–∞—Å—à–∏—Ä–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ–ª–µ–π

–î–æ–±–∞–≤–∏—Ç—å —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤–æ –≤—Å–µ –ø–∞—Ä—Å–µ—Ä—ã:

```python
STANDARD_FIELDS = {
    'sku': [
        # English
        'sku', 'product code', 'item code', 'product_id', 'item_id', 'code',
        # Russian
        '–∞—Ä—Ç–∏–∫—É–ª', '–∫–æ–¥', '–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞', '–∞—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞', '–Ω–æ–º–µ—Ä', '–Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞'
    ],
    'name': [
        # English
        'name', 'product name', 'description', 'product description', 'title', 'item',
        # Russian
        '–Ω–∞–∑–≤–∞–Ω–∏–µ', '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', '—Ç–æ–≤–∞—Ä', '–º–æ–¥–µ–ª—å', '–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞',
        '–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', '–æ–ø–∏—Å–∞–Ω–∏–µ', '–ø—Ä–æ–¥—É–∫—Ç'
    ],
    'price': [
        # English
        'price', 'unit price', 'cost', 'unit cost', 'amount', 'value',
        # Russian - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞–∑–≤–∞–Ω–∏–π —Ü–µ–Ω—ã
        '—Ü–µ–Ω–∞', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Ü–µ–Ω–∞ —Å –Ω–¥—Å', '—Ü–µ–Ω–∞ –±–µ–∑ –Ω–¥—Å',
        '–∑–∞–∫—É–ø–∫–∞', '–∑–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞', '–æ–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞', '–æ–ø—Ç',
        '–ø—Ä–µ–¥–∑–∞–∫–∞–∑', '–ø–∑', '—Å—Ç–æ–∫', '—Ä—Ü', '–º—Ä—Ü', '—Ä—Ä—Ü',
        '—Ü–µ–Ω–∞ —Ä—É–±', '—Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä—É–±', '—Ü–µ–Ω–∞ –±–µ–ª —Ä—É–±', '—Å—Ç–æ–∏–º–æ—Å—Ç—å –±–µ–ª —Ä—É–±'
    ],
    'availability': [  # –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –Ω–∞–ª–∏—á–∏—è
        # English
        'availability', 'stock', 'quantity', 'in stock', 'status',
        # Russian
        '–Ω–∞–ª–∏—á–∏–µ', '–æ—Å—Ç–∞—Ç–æ–∫', '—Å—Ç–∞—Ç—É—Å', '–≤ –Ω–∞–ª–∏—á–∏–∏', '–Ω–∞ —Å–∫–ª–∞–¥–µ'
    ],
    'rrp': [  # –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–π —Ä–æ–∑–Ω–∏—á–Ω–æ–π —Ü–µ–Ω—ã
        # English
        'rrp', 'retail price', 'msrp', 'recommended price',
        # Russian
        '–º—Ä—Ü', '—Ä—Ä—Ü', '—Ä–æ–∑–Ω–∏—á–Ω–∞—è —Ü–µ–Ω–∞', '—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞',
        '—Ü–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏', '—Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏'
    ]
}
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫

#### 3.1. –î–ª—è Excel (openpyxl)

```python
def _detect_merged_cells(self, worksheet, header_rows: List[int]) -> Dict[Tuple[int, int], Tuple[int, int]]:
    """–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö.
    
    Args:
        worksheet: openpyxl worksheet object
        header_rows: –°–ø–∏—Å–æ–∫ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (1-indexed)
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å: (row, col) -> (row_span, col_span)
    """
    merged_ranges = {}
    
    for merged_range in worksheet.merged_cells.ranges:
        min_row, min_col, max_row, max_col = merged_range.bounds
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —è—á–µ–π–∫–∞ –≤ —Å—Ç—Ä–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        if min_row in header_rows:
            # –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
            row_span = max_row - min_row + 1
            col_span = max_col - min_col + 1
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏
            for row in range(min_row, max_row + 1):
                for col in range(min_col, max_col + 1):
                    merged_ranges[(row, col)] = (row_span, col_span)
    
    return merged_ranges

def _expand_merged_header(self, header_value: str, col_span: int) -> List[str]:
    """–†–∞—Å—à–∏—Ä—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π —è—á–µ–π–∫–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫.
    
    Args:
        header_value: –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–π —è—á–µ–π–∫–∏
        col_span: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞–µ—Ç —è—á–µ–π–∫–∞
        
    Returns:
        –°–ø–∏—Å–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏
    """
    if col_span == 1:
        return [header_value]
    
    # –ï—Å–ª–∏ —è—á–µ–π–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∞, –¥—É–±–ª–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏
    # –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
    return [header_value] + [f"{header_value}_{i}" for i in range(1, col_span)]
```

#### 3.2. –î–ª—è Google Sheets (gspread)

```python
def _detect_merged_cells_gsheet(self, worksheet, header_rows: List[int]) -> Dict[Tuple[int, int], Tuple[int, int]]:
    """–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ –≤ Google Sheets.
    
    Args:
        worksheet: gspread worksheet object
        header_rows: –°–ø–∏—Å–æ–∫ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–æ–∫ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (1-indexed)
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å: (row, col) -> (row_span, col_span)
    """
    merged_ranges = {}
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
        sheet_id = worksheet.id
        spreadsheet = worksheet.spreadsheet
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º batch_get –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–π–∫–∞—Ö
        # –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: gspread –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º–æ–≥–æ API –¥–ª—è merged cells,
        # –ø–æ—ç—Ç–æ–º—É –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Google Sheets API –Ω–∞–ø—Ä—è–º—É—é
        # –∏–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
        
        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
        # –ï—Å–ª–∏ —è—á–µ–π–∫–∞ –ø—É—Å—Ç–∞—è, –Ω–æ —Å–æ—Å–µ–¥–Ω–∏–µ –Ω–µ –ø—É—Å—Ç—ã–µ, –≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —è—á–µ–π–∫–∞
        
    except Exception as e:
        logger.warning("failed_to_detect_merged_cells", error=str(e))
    
    return merged_ranges
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: Google Sheets API —á–µ—Ä–µ–∑ gspread –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–π–∫–∞—Ö. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–≤—Ä–∏—Å—Ç–∏–∫–∏.

### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

#### 4.1. –£–ª—É—á—à–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

```python
def _auto_detect_header_rows_improved(
    self,
    all_values: List[List[str]],
    start_row: int,
    max_row: int,
    log: Any
) -> List[int]:
    """–£–ª—É—á—à–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ò—â–µ—Ç —Å—Ç—Ä–æ–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ STANDARD_FIELDS
    2. –û—Ü–µ–Ω–∏–≤–∞–µ—Ç "–∑–∞–≥–æ–ª–æ–≤–æ—á–Ω–æ—Å—Ç—å" —Å—Ç—Ä–æ–∫–∏ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
    3. –£—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–∫–æ–Ω—Ç–∞–∫—Ç—ã, –∞–¥—Ä–µ—Å–∞) –ø–µ—Ä–µ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
    4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    
    Args:
        all_values: –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ª–∏—Å—Ç–∞ –∫–∞–∫ —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫
        start_row: –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (0-indexed)
        max_row: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (0-indexed, exclusive)
        log: Structured logger instance
        
    Returns:
        –°–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å—Ç—Ä–æ–∫ (0-indexed), –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
    """
    best_score = 0
    best_rows = [start_row]
    
    # –°–æ–∑–¥–∞–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –ø–æ–∏—Å–∫–∞
    normalized_fields = {}
    for field, variants in self.STANDARD_FIELDS.items():
        for variant in variants:
            normalized_fields[self._normalize_header(variant)] = field
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –≤–æ–∑–º–æ–∂–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Å—Ç—Ä–æ–∫
    for end_row in range(start_row, min(start_row + 5, max_row)):
        test_header_rows = list(range(start_row, end_row + 1))
        
        try:
            # –û–±—ä–µ–¥–∏–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫
            test_headers = self._combine_header_rows(
                [all_values[r] for r in test_header_rows if r < len(all_values)],
                log
            )
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
            normalized_headers = [self._normalize_header(h) for h in test_headers]
            
            # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            matches = {}
            for header in normalized_headers:
                for norm_variant, field in normalized_fields.items():
                    # –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                    if norm_variant == header:
                        matches[field] = matches.get(field, 0) + 2
                    # –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ)
                    elif norm_variant in header or header in norm_variant:
                        matches[field] = matches.get(field, 0) + 1
            
            # –í—ã—á–∏—Å–ª—è–µ–º –æ—Ü–µ–Ω–∫—É
            score = sum(matches.values())
            
            # –ë–æ–Ω—É—Å –∑–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (sku, name, price)
            required_fields = {'sku', 'name', 'price'}
            if required_fields.issubset(set(matches.keys())):
                score += 10
            
            # –®—Ç—Ä–∞—Ñ –∑–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Ç–µ–ª–µ—Ñ–æ–Ω—ã, –∞–¥—Ä–µ—Å–∞, email)
            metadata_keywords = ['—Ç–µ–ª', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–∞–¥—Ä–µ—Å', 'email', '—Å–∞–π—Ç', 'www', 'http']
            for header in normalized_headers:
                for keyword in metadata_keywords:
                    if keyword in header:
                        score -= 5
                        break
            
            log.debug(
                "header_detection_candidate",
                rows=test_header_rows,
                score=score,
                matches=matches
            )
            
            if score > best_score:
                best_score = score
                best_rows = test_header_rows
                
        except Exception as e:
            log.debug("header_detection_error", rows=test_header_rows, error=str(e))
            continue
    
    log.info(
        "header_rows_auto_detected",
        detected_rows=best_rows,
        score=best_score
    )
    
    return best_rows
```

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

#### 5.1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

```python
def _is_metadata_row(self, row_data: List[str], log: Any) -> bool:
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (–Ω–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏).
    
    –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç:
    - –ö–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (—Ç–µ–ª–µ—Ñ–æ–Ω—ã, email, –∞–¥—Ä–µ—Å–∞)
    - –û–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
    - –õ–æ–≥–æ—Ç–∏–ø—ã (–æ–±—ã—á–Ω–æ –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
    - –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ (–ª–∏–Ω–∏–∏, –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏)
    
    Args:
        row_data: –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
        log: Structured logger instance
        
    Returns:
        True –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —è–≤–ª—è–µ—Ç—Å—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
    """
    if not row_data or all(not cell or not str(cell).strip() for cell in row_data):
        return True  # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
    
    row_text = ' '.join(str(cell) for cell in row_data if cell).lower()
    
    # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    metadata_patterns = [
        r'—Ç–µ–ª[\.:]?\s*[\(\)\d\s\-]+',  # –¢–µ–ª–µ—Ñ–æ–Ω—ã
        r'\+?\d{1,3}[\s\-]?\(?\d{1,4}\)?[\s\-]?\d{1,4}[\s\-]?\d{1,4}',  # –ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
        r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}',  # Email
        r'https?://[^\s]+',  # URLs
        r'www\.[^\s]+',  # URLs –±–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
        r'–∞–¥—Ä–µ—Å[:\s]',  # –ê–¥—Ä–µ—Å–∞
        r'—Ä/—Å—á[:\s]',  # –†–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç
        r'—É–Ω–ø[:\s]',  # –£–ù–ü
        r'–ø–æ—Å—Ç–∞–≤—â–∏–∫[:\s]',  # –ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
        r'–∫–æ–º–ø–∞–Ω–∏—è[:\s]',  # –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
    ]
    
    import re
    for pattern in metadata_patterns:
        if re.search(pattern, row_text):
            return True
    
    # –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—á–µ–Ω—å –º–∞–ª–æ —Ç–µ–∫—Å—Ç–∞ (–º–µ–Ω–µ–µ 3 —Å–ª–æ–≤), –≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    word_count = len(row_text.split())
    if word_count < 3:
        return True
    
    return False
```

#### 5.2. –ü—Ä–æ–ø—É—Å–∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

```python
def _find_header_row_with_metadata_skip(
    self,
    all_values: List[List[str]],
    start_row: int,
    max_row: int,
    log: Any
) -> List[int]:
    """–ù–∞—Ö–æ–¥–∏—Ç —Å—Ç—Ä–æ–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –ø—Ä–æ–ø—É—Å–∫–∞—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.
    
    Args:
        all_values: –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –ª–∏—Å—Ç–∞
        start_row: –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (0-indexed)
        max_row: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (0-indexed, exclusive)
        log: Structured logger instance
        
    Returns:
        –°–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å—Ç—Ä–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (0-indexed)
    """
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–µ
    actual_start = start_row
    for row_idx in range(start_row, min(start_row + 10, max_row)):
        if row_idx >= len(all_values):
            break
        
        row_data = all_values[row_idx]
        if not self._is_metadata_row(row_data, log):
            actual_start = row_idx
            break
    
    log.debug(
        "metadata_skipped",
        original_start=start_row,
        actual_start=actual_start,
        skipped_rows=actual_start - start_row
    )
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    return self._auto_detect_header_rows_improved(
        all_values,
        actual_start,
        max_row,
        log
    )
```

### 6. –£–ª—É—á—à–µ–Ω–∏–µ –Ω–µ—á–µ—Ç–∫–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è

#### 6.1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

```python
from rapidfuzz import fuzz, process

def _fuzzy_match_header(
    self,
    header: str,
    candidates: List[str],
    threshold: float = 0.6
) -> Optional[Tuple[str, float]]:
    """–ù–µ—á–µ—Ç–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏.
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç RapidFuzz –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
    
    Args:
        header: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞
        candidates: –°–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
        threshold: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ (0.0 - 1.0)
        
    Returns:
        Tuple (matched_candidate, similarity_score) –∏–ª–∏ None
    """
    if not candidates:
        return None
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º process.extractOne –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª—É—á—à–µ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
    result = process.extractOne(
        header,
        candidates,
        scorer=fuzz.WRatio,  # Weighted Ratio - –ª—É—á—à–∏–π –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        score_cutoff=int(threshold * 100)
    )
    
    if result:
        matched, score, _ = result
        return (matched, score / 100.0)  # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫ 0.0-1.0
    
    return None
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: RapidFuzz —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–ª—è Phase 4 (Product Matching), –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

### 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

#### 7.1. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

```python
def _build_hierarchical_headers(
    self,
    header_rows_data: List[List[str]],
    log: Any
) -> List[Dict[str, Any]]:
    """–°—Ç—Ä–æ–∏—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.
    
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –≥–ª–∞–≤–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏.
    –ù–∞–ø—Ä–∏–º–µ—Ä:
    - –°—Ç—Ä–æ–∫–∞ 1: "–¶–µ–Ω–∞" (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ –Ω–∞ 2 –∫–æ–ª–æ–Ω–∫–∏)
    - –°—Ç—Ä–æ–∫–∞ 2: "–û–ø—Ç" | "–†–†–¶"
    
    –†–µ–∑—É–ª—å—Ç–∞—Ç:
    [
        {"name": "–¶–µ–Ω–∞ - –û–ø—Ç", "col": 0, "span": 1},
        {"name": "–¶–µ–Ω–∞ - –†–†–¶", "col": 1, "span": 1}
    ]
    
    Args:
        header_rows_data: –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
        log: Structured logger instance
        
    Returns:
        –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
    """
    if not header_rows_data:
        return []
    
    max_cols = max(len(row) for row in header_rows_data) if header_rows_data else 0
    hierarchical_headers = []
    
    for col_idx in range(max_cols):
        header_parts = []
        parent_header = None
        
        # –°–æ–±–∏—Ä–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
        for row_idx, row_data in enumerate(header_rows_data):
            if col_idx < len(row_data):
                cell_value = row_data[col_idx]
                if cell_value and str(cell_value).strip():
                    value = str(cell_value).strip()
                    
                    # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞, —ç—Ç–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫
                    if row_idx == 0:
                        parent_header = value
                    else:
                        # –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ - –æ–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º
                        if parent_header:
                            header_parts.append(f"{parent_header} - {value}")
                        else:
                            header_parts.append(value)
        
        # –ï—Å–ª–∏ –µ—Å—Ç—å —á–∞—Å—Ç–∏, –æ–±—ä–µ–¥–∏–Ω—è–µ–º –∏—Ö
        if header_parts:
            combined = ' | '.join(header_parts)
        elif parent_header:
            combined = parent_header
        else:
            combined = f"Column_{col_idx + 1}"
        
        hierarchical_headers.append({
            "name": combined,
            "col": col_idx,
            "original_parts": header_parts if header_parts else [parent_header] if parent_header else []
        })
    
    return hierarchical_headers
```

### 8. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ)
1. ‚úÖ **–†–∞—Å—à–∏—Ä–∏—Ç—å STANDARD_FIELDS —Ä—É—Å—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏** - –≤–æ –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–∞—Ö
2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** - —É–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤, —Å–∫–æ–±–æ–∫
3. ‚úÖ **–£–ª—É—á—à–∏—Ç—å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** - —É—á–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –ª—É—á—à–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ)
4. ‚ö†Ô∏è **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫ –¥–ª—è Excel** - —á–µ—Ä–µ–∑ openpyxl
5. ‚ö†Ô∏è **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤** - –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏
6. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è availability –∏ rrp** - —Ä–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)
7. üí° **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫ –¥–ª—è Google Sheets** - —á–µ—Ä–µ–∑ —ç–≤—Ä–∏—Å—Ç–∏–∫–∏
8. üí° **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RapidFuzz –¥–ª—è –Ω–µ—á–µ—Ç–∫–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è** - –≤–º–µ—Å—Ç–æ difflib
9. üí° **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏** - –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 9. –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

#### –ü—Ä–∏–º–µ—Ä 1: Shtenli (—ç–ª–µ–∫—Ç—Ä–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç)
```json
{
  "header_row": 3,
  "header_row_end": 3,
  "data_start_row": 4,
  "column_mapping": {
    "sku": "–ú–æ–¥–µ–ª—å",
    "name": "–ú–æ–¥–µ–ª—å",
    "price": "–ó–∞–∫—É–ø–∫–∞ –ë–µ–ª. —Ä—É–±."
  }
}
```

#### –ü—Ä–∏–º–µ—Ä 2: Smart Balance
```json
{
  "header_row": 1,
  "header_row_end": 1,
  "data_start_row": 10,
  "column_mapping": {
    "sku": "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ|–°—Å—ã–ª–∫–∞",
    "name": "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ|–°—Å—ã–ª–∫–∞",
    "price": "–¶–µ–Ω–∞ —Å –ù–î–°* (BYN)"
  }
}
```

#### –ü—Ä–∏–º–µ—Ä 3: TECHNO GARDEN (–º–æ—Ç–æ–±–ª–æ–∫–∏)
```json
{
  "header_row": 7,
  "header_row_end": 9,
  "data_start_row": 10,
  "column_mapping": {
    "sku": "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞",
    "name": "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞",
    "price": "–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ —Å –ù–î–°"
  }
}
```

#### –ü—Ä–∏–º–µ—Ä 4: AVM (—ç–ª–µ–∫—Ç—Ä–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç)
```json
{
  "header_row": 2,
  "header_row_end": 2,
  "data_start_row": 4,
  "column_mapping": {
    "sku": "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",
    "name": "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ",
    "price": "–°—Ç–æ–∫*, —Ä—É–±"
  }
}
```

### 10. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 10.1. –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏

1. **–¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤**
   - –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Å—Ç—Ä–æ–∫–∞—Ö 7-9
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ

2. **–¢–µ—Å—Ç –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã—Ö —è—á–µ–µ–∫**
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–¶–µ–Ω–∞" –æ–±—ä–µ–¥–∏–Ω–µ–Ω –Ω–∞ 2 –∫–æ–ª–æ–Ω–∫–∏
   - –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ "–û–ø—Ç" –∏ "–†–†–¶"
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "–¶–µ–Ω–∞ - –û–ø—Ç", "–¶–µ–Ω–∞ - –†–†–¶"

3. **–¢–µ—Å—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö**
   - –ö–æ–Ω—Ç–∞–∫—Ç—ã –≤ —Å—Ç—Ä–æ–∫–∞—Ö 1-5
   - –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ 7
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–æ–ø—É—Å–∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ 7

4. **–¢–µ—Å—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏**
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–¶–µ–Ω–∞ —Å –ù–î–°* (BYN)"
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫ "—Ü–µ–Ω–∞ —Å –Ω–¥—Å"

5. **–¢–µ—Å—Ç —Ä—É—Å—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π**
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
   - –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –ø–æ–ª–µ–º "name"

### 11. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–∞—Ä—Å–µ—Ä–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–ª–æ–≤–∞—Ä—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ–ª–µ–π –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Ä–µ—à–∏—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º —Å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–ª–æ–Ω–æ–∫.

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Parser Guide](../parser-guide.md) - –û–±—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–∞—Ä—Å–µ—Ä–∞–º
- [Quick Start Guide](./01-quick-start.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [Google Sheets Setup](./02-google-sheets-setup.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets

